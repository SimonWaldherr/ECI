<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>External Code Interface (ECI): A Tour Through `eci_interface.h`</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">External Code Interface (ECI)
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">A Tour Through `eci_interface.h` </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="interface_overview"></a>
Overview</h1>
<p>As mentioned during the introduction, <code>eci_interface.h</code> defined the interfaces to the external code for the ECI. From the interface header, your application can define a set of the ECI services needed by the app, software bus messages, common macros, the per-tick run function, and other miscellaneous utility functions like initialize or teardown. Any of these definitions may be located anywhere so long as they're accessible (ie, included) in <code>eci_interface.h</code>. Due to how the ECI works internally, the interface file MUST be titled as <code>eci_interface.h</code> and linked along side your project. To provide a more concrete reference of what's included in the interface file, we will accompany our explanations along side the simple app source code located in the examples directory.</p>
 <h1><a class="anchor" id="interface_includes"></a>
Includes</h1>
<p>Since later on in the interface header we use event filters, we need to include <code>cfe_evs.h</code> to gain access to the macros. <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;cfe_evs.h&quot;</span>     </div>
</div><!-- fragment --></p>
<p>These next two includes give us access to the ECI data types and various settings defined in <code><a class="el" href="eci__app__cfg_8h.html" title="Contains all of the configurable options (defined as macros) which change how the ECI interacts with ...">eci_app_cfg.h</a></code>. <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="eci__app_8h.html">eci_app.h</a>&quot;</span>     </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="eci__app__cfg_8h.html">eci_app_cfg.h</a>&quot;</span> </div>
</div><!-- fragment --></p>
<p><div class="fragment"></div><!-- fragment --> We now begin including our application specific information. First, we include the header file for the external code, which must provide access to structures definitions and function prototypes used in the inerface header. After including the wrapper, we include two headers commonly used to define performance and message IDs for cFE apps. In the cFE, message ID's are used to route messages to their intended target. Performance ID's are used to denote messages containing information for housekeeping. <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;external_code.h&quot;</span>     </div>
<div class="line"><span class="preprocessor">#include &quot;table_validation.h&quot;</span>  </div>
<div class="line"><span class="preprocessor">#include &quot;simpleECI_app_msgids.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;simpleECI_app_perfids.h&quot;</span></div>
</div><!-- fragment --></p>
<h1><a class="anchor" id="Macros"></a>
Macros</h1>
<p>Here we define the macros which the ECI uses to define the app interace the ECI exposes to the rest of the CFS system. The revision number will be included in the event generated by initialization and the Noop command, and is intended to support verification of app versions. Specifics on what each MID used in this section does can be found <a class="el" href="eci_macros.html">here</a>. <div class="fragment"><div class="line"><span class="preprocessor">#define ECI_APP_REVISION_NUMBER                &quot;1.0&quot;</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define ECI_FLAG_MID                   SIMPLE_ECI_FLAG_MID</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define ECI_CMD_MID                    SIMPLE_ECI_CMD_MID</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define ECI_PERF_ID                    SIMPLE_ECI_PERF_ID</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define ECI_TICK_MID                   SIMPLE_ECI_TICK_MID</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define ECI_HK_MID                     SIMPLE_ECI_HK_MID</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define ECI_TBL_MANAGE_MID             SIMPLE_ECI_TBL_MANAGE_MID</span></div>
<div class="line"><span class="preprocessor">#define ECI_SEND_HK_MID                SIMPLE_ECI_SEND_HK_MID</span></div>
</div><!-- fragment --></p>
<p><div class="fragment"></div><!-- fragment --> The ECI_APP_MAIN macro defines the entry point for the app defined in the cFE startup script. The ECI will use this name for its main function which initializes the app, execute it's run loop on wake up, and calls the teardown function on termination.</p>
<p><div class="fragment"><div class="line"><span class="preprocessor">#define ECI_APP_MAIN                   sa_AppMain</span></div>
</div><!-- fragment --></p>
<p><div class="fragment"></div><!-- fragment --> ECI uses the following versions of the app name in various contexts, such as registering the app with cFE executive services and in various event messages. <div class="fragment"><div class="line"><span class="preprocessor">#define ECI_APP_NAME_UPPER             &quot;SA&quot;</span></div>
<div class="line"><span class="preprocessor">#define ECI_APP_NAME_LOWER             &quot;sa&quot;</span></div>
</div><!-- fragment --></p>
<p><div class="fragment"></div><!-- fragment --> In order to reduce resource usage, ECI only enables features if we request them, we need to tell ECI we are using FSW parameter tables by defining ECI_PARAM_TBL_DEFINED. <div class="fragment"><div class="line"><span class="preprocessor">#define ECI_PARAM_TBL_DEFINED</span></div>
</div><!-- fragment --> </p>
<h1><a class="anchor" id="Structures"></a>
Structures</h1>
<p>ECI operates on the assumption that all tables are NULL terminated. An example of what this means for each structure can be found within it's source code. </p>
<hr/>
<p>The actual parameter tables are defined by declaring an array of <a class="el" href="struct_e_c_i___tbl__t.html">ECI_Tbl_t</a> objects. This data is then used to load the corresponding FSW tables on startup of the app or whenever ECI_TBL_MANAGE_MID gets sent to the app. ECI expects to place all table files into the same directory indicated by PARAM_TBL_PATH_PREFIX in the <a class="el" href="eci__app__cfg_8h.html" title="Contains all of the configurable options (defined as macros) which change how the ECI interacts with ...">eci_app_cfg.h</a> file thus all filenames will be relative to that value. <div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code" href="struct_e_c_i___tbl__t.html">ECI_Tbl_t</a> ECI_ParamTable[] = {</div>
<div class="line">  {</div>
<div class="line">    &amp;(convParamsPtr),                       </div>
<div class="line">    <span class="stringliteral">&quot;convParams&quot;</span>,                           </div>
<div class="line">    <span class="stringliteral">&quot;SA app&#39;s conversion parameter table&quot;</span>,  </div>
<div class="line">    <span class="stringliteral">&quot;convParam.tbl&quot;</span>,                        </div>
<div class="line">    <span class="keyword">sizeof</span>(convParamStruct_t),              </div>
<div class="line">    &amp;Table_Validation0                      </div>
<div class="line">  },</div>
<div class="line"></div>
<div class="line">  {</div>
<div class="line">    &amp;(checkParamsPtr),</div>
<div class="line">    <span class="stringliteral">&quot;checkParams&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;SA app&#39;s check parameter table&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;checkParams.tbl&quot;</span>,</div>
<div class="line">    <span class="keyword">sizeof</span>(checkParamStruct_t),</div>
<div class="line">    NULL                                    </div>
<div class="line">  },</div>
<div class="line"></div>
<div class="line">  { 0, 0, 0, 0, 0 }                         </div>
<div class="line">};</div>
</div><!-- fragment --></p>
<p><div class="fragment"></div><!-- fragment --> ECI allows the output of state tables registered with table services. A state table differs from a parameter table in that a state table serves as a way to retreive current state information from an app. In our simple app, we've commented out this functionality. <div class="fragment"><div class="line"><span class="comment">/*#define ECI_STATE_TBL_DEFINED*/</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/*#define ECI_STATE_TABLE_NAME &quot;SA.STATE&quot;*/</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/*extern stateStruct_t stateData;*/</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/*ECI_TBL_FILEDEF(CSL_TBL_FileDef_State, state_TBL, SA.STATE, SA STATES, sa_state.tbl)*/</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/*#define ECI_STATE_TBL state_TBL  */</span></div>
</div><!-- fragment --></p>
<p><div class="fragment"></div><!-- fragment --> The message table details what messages should be sent out. In our simpleECIApp's case, when this app wakes up it sends a message if dataUpdated is set to true. The data contained in said massage will be the contents of the object pointed to by the second parameter. We should expect this sentinel value to be global. Entries in this table get registered with the software bus according to the MID provided. <div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code" href="struct_e_c_i___msg__t.html">ECI_Msg_t</a> ECI_MsgSnd[] = {</div>
<div class="line">  { 0x0AA5,                        </div>
<div class="line">    &amp;outputData,                   </div>
<div class="line">    <span class="keyword">sizeof</span>(outputStruct_t),        </div>
<div class="line">    NULL,                          </div>
<div class="line">    &amp;dataUpdated },                </div>
<div class="line">  { 0, NULL, 0, NULL, NULL }       </div>
<div class="line">};</div>
</div><!-- fragment --></p>
<p><div class="fragment"></div><!-- fragment --> Input packets directed to the app will be requested based on what was provided in the message recieve table. Similar to the message recieve object, the first value will be used as the message ID for the app to subscribe to. In the example, we use the first message as a means to parse custom commands. The Consultative Committee for Space Data Systems (CCSDS) details that the MID for command packets should be formated like 0x1*** and this specification tells ECI to allocate buffer space. <div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code" href="struct_e_c_i___msg__t.html">ECI_Msg_t</a> ECI_MsgRcv[] = {</div>
<div class="line">  { 0x1AA1,                   </div>
<div class="line">    &amp;input_CmdPkt,            </div>
<div class="line">    <span class="keyword">sizeof</span>(inputCmdPkt_t),    </div>
<div class="line">    &amp;inputCmdPkt_queue[0],    </div>
<div class="line">    NULL },                   </div>
<div class="line">  { 0x0AA6,</div>
<div class="line">    &amp;inputData,</div>
<div class="line">    <span class="keyword">sizeof</span>(inputStruct_t),</div>
<div class="line">    NULL,                      </div>
<div class="line">    NULL },                    </div>
<div class="line">  { 0, NULL, 0, NULL, NULL }   </div>
<div class="line">};</div>
</div><!-- fragment --></p>
<h1><a class="anchor" id="Events"></a>
Events</h1>
<p>Since events are optional to ECI, we need to tell ECI to initialize events. <div class="fragment"><div class="line"><span class="preprocessor">#define ECI_EVENT_TABLE_DEFINED</span></div>
</div><!-- fragment --></p>
<p><div class="fragment"></div><!-- fragment --> Much like the message send and receive arrays, events use a similar structure. Whether ECI sends the message depends on the status of the flag provided (in the first case isOverThresh). Since each of the arrays are limited to being declared on the stack, the ECI is limited to events with a maximum of 5 arguments. After specifying the number of data points, you must specify an ID for the message. After the ID, ECI expects to be told what the type of this event will be according to CFE table services and an event mask for the ID.</p>
<p>There are two strings present in each example. The first behaves identically to the C standard printf() function and follows the same format patterns. The second will be printed along side the message which can be useful to indicate where the problem occured. The last 5 values in the data structure are reserved for pointers to data to be placed inside the format string. Even though you might need less than 5 values, ECI expects something for each value and thus we fill the structure with zeros. <div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_e_c_i___evs__t.html">ECI_Evs_t</a> ECI_Events[] = {</div>
</div><!-- fragment --></p>
<h1><a class="anchor" id="Flags"></a>
Flags</h1>
<p>The flag section of ECI allows an app to set its bit flags in FDC by defining ECI_FLAG_TABLE_DEFINE. <div class="fragment"><div class="line"><span class="preprocessor">#define ECI_FLAG_TABLE_DEFINED</span></div>
</div><!-- fragment --> The first value of this structure details the flag ID to be set, this number will be unique to this app. The second value contains the external code flag to check to set a matching flag in the CFE. <div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_e_c_i___flag__t.html">ECI_Flag_t</a> ECI_Flags[] = {</div>
<div class="line">  { &amp;(uint8){1},                        </div>
<div class="line">    (<span class="keywordtype">boolean</span> *)&amp;isOverThresh            </div>
<div class="line">  },</div>
<div class="line"></div>
<div class="line">  { 0, 0 }                              </div>
<div class="line">};</div>
</div><!-- fragment --></p>
<h1><a class="anchor" id="Functions"></a>
Functions</h1>
<p>To tell ECI what functions to execute at runtime, there are 3 macros that can be defined. Both the init and term functions can be omitted but there ECI_STEP_FCN must be defined.</p>
<p>The init function gets called by the ECI at program startup and can be used to set default variables in the external code. <div class="fragment"><div class="line"><span class="preprocessor">#define ECI_INIT_FCN                 setup();</span></div>
</div><!-- fragment --> The step function represents the running loop of the external code. Each time the app gets woken up according to the ECI_TICK_MID, the step function gets called. <div class="fragment"><div class="line"><span class="preprocessor">#define ECI_STEP_FCN                 run();</span></div>
</div><!-- fragment --> The termination function gets called at program termination which can be used to free up system resources or do general clean up. <div class="fragment"><div class="line"><span class="preprocessor">#define ECI_TERM_FCN                 teardown();</span></div>
</div><!-- fragment --> </p>
</div></div><!-- contents -->
